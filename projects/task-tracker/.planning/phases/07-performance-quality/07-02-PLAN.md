---
phase: 07-performance-quality
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:

  - src/shared/components/LazyFileDropzone.tsx
  - src/shared/components/LazyFileList.tsx
  - src/shared/components/TaskEditFormWithTags.tsx
  - src/app/(app)/tasks/[id]/edit/page.tsx
  - next.config.ts

autonomous: true

must_haves:
  truths:

```markdown

- "FileDropzone and FileList components load lazily"
- "Loading fallbacks show while heavy components load"
- "Task edit page loads faster without file components initially"
- "No SSR errors from file-related browser APIs"

```yaml

  artifacts:

```yaml

- path: "src/shared/components/LazyFileDropzone.tsx"

  provides: "Lazy-loaded file dropzone wrapper"
  exports: ["LazyFileDropzone"]

- path: "src/shared/components/LazyFileList.tsx"

  provides: "Lazy-loaded file list wrapper"
  exports: ["LazyFileList"]

- path: "next.config.ts"

  provides: "Bundle optimization settings"
  contains: "optimizePackageImports"

```

  key_links:

```yaml

- from: "src/shared/components/TaskEditFormWithTags.tsx"

  to: "src/shared/components/LazyFileDropzone.tsx"
  via: "dynamic import"
  pattern: "LazyFileDropzone"

```html

---

<objective>
Implement lazy loading for heavy client components using next/dynamic

Purpose: Reduce initial bundle size by deferring load of file upload/management
components. FileDropzone includes tus-js-client, react-dropzone, and file-type -
these should only load when editing tasks with file attachments.

Output: Lazy-loaded wrappers for file components, updated imports in
TaskEditFormWithTags
</objective>

<execution_context>
@/Users/dansidanutz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dansidanutz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-performance-quality/07-CONTEXT.md
@.planning/phases/07-performance-quality/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create lazy-loaded file component wrappers</name>
  <files>

```text
src/shared/components/LazyFileDropzone.tsx
src/shared/components/LazyFileList.tsx

```

  </files>
  <action>
Create wrapper components using next/dynamic to lazy-load file components:

1. `LazyFileDropzone.tsx`:

```tsx

'use client'

import dynamic from 'next/dynamic'

// Lazy load FileDropzone with loading fallback
// ssr: false because it uses browser file APIs
const FileDropzone = dynamic(
  () => import('./FileDropzone').then((mod) => mod.FileDropzone),
  {

```javascript

loading: () => (
  <div className="border-2 border-dashed border-zinc-600 rounded-lg p-8">

```html

<div className="animate-pulse text-center">
  <div className="h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded-full
  mx-auto mb-4" />
  <div className="h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded mx-auto
  mb-2" />
  <div className="h-3 w-48 bg-gray-200 dark:bg-gray-700 rounded mx-auto" />
</div>

```

  </div>
),
ssr: false,

```javascript
  }
)

// Re-export with same props interface
export { FileDropzone as LazyFileDropzone }
export type { FileDropzoneProps } from './FileDropzone'

```python

Note: Need to also export FileDropzoneProps from FileDropzone.tsx if not already
exported.

2. `LazyFileList.tsx`:

```tsx

'use client'

import dynamic from 'next/dynamic'

// Lazy load FileList with loading fallback
const FileList = dynamic(
  () => import('./FileList').then((mod) => mod.FileList),
  {

```javascript

loading: () => (
  <div className="space-y-2 animate-pulse">

```
<div className="flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800
rounded">
  <div className="h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded" />
  <div className="flex-1">

```
<div className="h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded mb-1" />
<div className="h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded" />

```
  </div>
</div>

```html

  </div>
),
ssr: false,

```
  }
)

export { FileList as LazyFileList }

```yaml

For FileDropzone.tsx, ensure the interface is exported:

```tsx

export interface FileDropzoneProps {
  taskId: string
  onUploadComplete?: (fileId: string, filename: string) => void
  onUploadError?: (filename: string, error: string) => void
  maxFiles?: number
  disabled?: boolean
  compact?: boolean
}

```html

  </action>
  <verify>
Files exist and TypeScript compiles:

- `ls src/shared/components/LazyFile*.tsx`
- `npx tsc --noEmit`

  </verify>
  <done>
LazyFileDropzone and LazyFileList wrappers exist using next/dynamic with proper
loading fallbacks and ssr: false
  </done>
</task>

<task type="auto">
  <name>Task 2: Update TaskEditFormWithTags to use lazy components</name>
  <files>

```html

src/shared/components/TaskEditFormWithTags.tsx
src/shared/components/index.ts

```html

  </files>
  <action>
Update TaskEditFormWithTags to use the lazy-loaded wrappers:

1. In `TaskEditFormWithTags.tsx`:
   - Replace `import { FileDropzone } from './FileDropzone'` with `import {

```
 LazyFileDropzone } from './LazyFileDropzone'`

```python

   - Replace `import { FileList } from './FileList'` with `import { LazyFileList

```python
 } from './LazyFileList'`

```markdown

   - Update JSX to use LazyFileDropzone and LazyFileList

Before:

```tsx

import { FileDropzone } from './FileDropzone'
import { FileList } from './FileList'
...
<FileDropzone taskId={task.id} ... />
<FileList files={attachments} ... />

```

After:

```tsx

import { LazyFileDropzone } from './LazyFileDropzone'
import { LazyFileList } from './LazyFileList'
...
<LazyFileDropzone taskId={task.id} ... />
<LazyFileList files={attachments} ... />

```yaml

2. Update `src/shared/components/index.ts` to export lazy components:
   - Add exports for LazyFileDropzone and LazyFileList

  </action>
  <verify>
Verify the task edit page still works:

- Start dev server: `npm run dev`
- Navigate to /tasks, create/edit a task
- File dropzone should load after a brief moment
- TypeScript compiles: `npx tsc --noEmit`

  </verify>
  <done>
TaskEditFormWithTags uses lazy-loaded file components, reducing initial bundle
size for task edit page
  </done>
</task>

<task type="auto">
  <name>Task 3: Add bundle optimization to Next.js config</name>
  <files>next.config.ts</files>
  <action>
Update next.config.ts to optimize package imports:

```typescript

import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  experimental: {

```yaml

serverActions: {
  bodySizeLimit: '5mb',
},
// Optimize icon and utility library imports
optimizePackageImports: ['@heroicons/react'],

```yaml
  },
  // Keep sharp as external (server-only)
  serverExternalPackages: ['sharp'],
  images: {

```yaml

remotePatterns: [
  {

```
protocol: 'https',
hostname: 'avatars.githubusercontent.com',

```text

  },
  {

```
protocol: 'https',
hostname: 'github.com',

```text

  },
],

```
  },
};

export default nextConfig;

```yaml

This optimizes:

- @heroicons/react: Only bundles used icons instead of entire library
- sharp: Keeps it server-side only (already used for thumbnails)

  </action>
  <verify>
Build completes successfully with optimization:

- `npm run build`
- Check build output for bundle sizes

  </verify>
  <done>
Next.js config includes optimizePackageImports for bundle size reduction
  </done>
</task>

</tasks>

<verification>

1. Build succeeds: `npm run build`
2. Task edit page loads quickly (file components load lazily)
3. File upload still works correctly
4. No SSR errors in console
5. Bundle analyzer shows file components in separate chunks (optional check)

</verification>

<success_criteria>

- Heavy file components (FileDropzone, FileList) load lazily with visible loading

  states

- Initial page load doesn't include file upload libraries
- Task edit page remains fully functional
- Build succeeds without errors

</success_criteria>

<output>
After completion, create
`.planning/phases/07-performance-quality/07-02-SUMMARY.md`
</output>
