---
phase: 07-performance-quality
plan: 04
type: execute
wave: 2
depends_on: [07-01, 07-02]
files_modified:

  - src/shared/components/WebVitalsReporter.tsx
  - src/app/layout.tsx
  - src/app/api/analytics/vitals/route.ts
  - src/shared/lib/dal.ts

autonomous: false

must_haves:
  truths:

```markdown

- "Core Web Vitals are captured and logged"
- "Application loads within 2 seconds"
- "No layout shifts visible during loading (CLS < 0.1)"
- "User interactions respond within 200ms (INP < 200ms)"

```yaml

  artifacts:

```yaml

- path: "src/shared/components/WebVitalsReporter.tsx"

  provides: "Client component for reporting Core Web Vitals"
  exports: ["WebVitalsReporter"]

- path: "src/app/api/analytics/vitals/route.ts"

  provides: "API endpoint to receive vitals data"
  exports: ["POST"]

```yaml

  key_links:

```yaml

- from: "src/app/layout.tsx"

  to: "src/shared/components/WebVitalsReporter.tsx"
  via: "import and render"
  pattern: "WebVitalsReporter"

```html

---

<objective>
Implement Core Web Vitals monitoring and verify performance benchmarks

Purpose: Capture real performance metrics (LCP, INP, CLS) for monitoring and
ensure the application meets production quality standards. This provides
visibility into actual user experience and validates that optimization work was
effective.

Output: WebVitalsReporter component integrated into root layout, vitals API
endpoint, performance verification
</objective>

<execution_context>
@/Users/dansidanutz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dansidanutz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-performance-quality/07-CONTEXT.md
@.planning/phases/07-performance-quality/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Web Vitals reporter and API endpoint</name>
  <files>

```text
src/shared/components/WebVitalsReporter.tsx
src/app/api/analytics/vitals/route.ts

```

  </files>
  <action>

1. Create `WebVitalsReporter.tsx`:

```tsx

'use client'

import { useReportWebVitals } from 'next/web-vitals'

export function WebVitalsReporter() {
  useReportWebVitals((metric) => {

```javascript

// Log to console in development
if (process.env.NODE_ENV === 'development') {
  const { name, value, rating } = metric
  const color = rating === 'good' ? 'green' : rating === 'needs-improvement' ?
  'yellow' : 'red'
  console.log(`[Web Vitals] ${name}: ${Math.round(value)}ms (${rating})`,
  `color: ${color}`)
}

// Send to analytics endpoint
const body = JSON.stringify({
  name: metric.name,
  value: metric.value,
  rating: metric.rating,
  id: metric.id,
  navigationType: metric.navigationType,
  delta: metric.delta,
})

// Use sendBeacon for reliability, fall back to fetch
const url = '/api/analytics/vitals'
if (navigator.sendBeacon) {
  navigator.sendBeacon(url, body)
} else {
  fetch(url, {

```yaml
body,
method: 'POST',
keepalive: true,
headers: { 'Content-Type': 'application/json' },

```yaml

  })
}

```yaml
  })

  return null
}

```yaml

2. Create `src/app/api/analytics/vitals/route.ts`:

```typescript

import { NextRequest, NextResponse } from 'next/server'

type WebVitalsMetric = {
  name: 'CLS' | 'FCP' | 'INP' | 'LCP' | 'TTFB'
  value: number
  rating: 'good' | 'needs-improvement' | 'poor'
  id: string
  navigationType: string
  delta: number
}

// Thresholds from Google Core Web Vitals
const THRESHOLDS = {
  LCP: { good: 2500, poor: 4000 },
  INP: { good: 200, poor: 500 },
  CLS: { good: 0.1, poor: 0.25 },
  FCP: { good: 1800, poor: 3000 },
  TTFB: { good: 800, poor: 1800 },
}

export async function POST(request: NextRequest) {
  try {

```javascript

const metric: WebVitalsMetric = await request.json()

// Log for monitoring (in production, send to analytics service)
const threshold = THRESHOLDS[metric.name as keyof typeof THRESHOLDS]
const status = threshold
  ? metric.value <= threshold.good ? 'GOOD' : metric.value <= threshold.poor ?
  'NEEDS_IMPROVEMENT' : 'POOR'
  : 'UNKNOWN'

console.log(`[Vitals] ${metric.name}: ${metric.value.toFixed(2)} (${status}) -
${metric.navigationType}`)

// In a real app, you would store this in database or send to analytics
// For now, we just log it for verification

return NextResponse.json({ received: true })

```
  } catch (error) {

```yaml

console.error('[Vitals] Error processing metric:', error)
return NextResponse.json({ error: 'Invalid metric' }, { status: 400 })

```html

  }
}

```html

  </action>
  <verify>

- Files exist: `ls src/shared/components/WebVitalsReporter.tsx

  src/app/api/analytics/vitals/route.ts`

- TypeScript compiles: `npx tsc --noEmit`

  </verify>
  <done>
WebVitalsReporter component and vitals API endpoint created for Core Web Vitals
monitoring
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate WebVitalsReporter into root layout</name>
  <files>

```html

src/app/layout.tsx
src/shared/components/index.ts

```html

  </files>
  <action>

1. Update `src/app/layout.tsx` to include WebVitalsReporter:

```tsx

import type { Metadata } from "next";
import "./globals.css";
import { WebVitalsReporter } from "@/shared/components/WebVitalsReporter";

export const metadata: Metadata = {
  title: "Task Tracker",
  description: "A task tracking application built with Next.js",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (

```html

<html lang="en">
  <body className="antialiased">

```
<WebVitalsReporter />
{children}

```html

  </body>
</html>

```html

  );
}

```html

2. Update `src/shared/components/index.ts` to export WebVitalsReporter

  </action>
  <verify>

- Layout includes reporter: `grep WebVitalsReporter src/app/layout.tsx`
- Dev server runs and console shows vitals: `npm run dev`
- Navigate between pages to trigger metrics

  </verify>
  <done>
WebVitalsReporter integrated into root layout, metrics logged to console and API
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Performance verification</name>
  <what-built>
Complete performance optimization suite:

- Skeleton loading screens for all routes
- Lazy loading for heavy file components
- Mobile swipe gestures and responsive navigation
- Core Web Vitals monitoring

  </what-built>
  <how-to-verify>

1. **Loading States (LCP < 2.5s target)**
   - Start dev server: `npm run dev`
   - Open browser DevTools > Network tab, enable "Slow 3G" throttling
   - Navigate to <http://localhost:3000/dashboard>
   - Verify: Skeleton appears immediately, content loads within ~2-3 seconds
   - Navigate to /tasks - same behavior

2. **Layout Stability (CLS < 0.1 target)**
   - Open DevTools > Lighthouse tab
   - Run audit on /tasks page (Mobile mode)
   - Check CLS score - should be < 0.1
   - Visually: No content jumping during load

3. **Mobile Experience**
   - Open DevTools, enable device toolbar (Ctrl+Shift+M)
   - Select iPhone 14 or similar
   - Navigate to /tasks
   - Verify: Hamburger menu visible in header
   - Tap hamburger - menu slides in with Dashboard/Tasks links
   - On task list: See "Swipe right to complete, left to delete" hint
   - Swipe a task right - green background appears, task completes
   - Swipe a task left - red background, confirmation dialog

4. **Lazy Loading**
   - Navigate to /tasks/[id]/edit (any task)
   - Open DevTools > Network tab
   - Observe: File dropzone area shows skeleton briefly, then loads
   - This confirms FileDropzone loaded lazily

5. **Core Web Vitals Console Logging**
   - Open DevTools Console
   - Navigate between pages
   - Verify: See "[Web Vitals] LCP: Xms", "[Web Vitals] CLS: X", etc.
   - Check that most metrics show "good" rating

6. **Build Verification**
   - Run: `npm run build`
   - Check build output for any warnings
   - Verify build completes successfully

  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues
  found</resume-signal>
</task>

</tasks>

<verification>

1. Core Web Vitals logged to console during navigation
2. Vitals API endpoint receives and logs metrics
3. Lighthouse audit shows good scores:
   - LCP < 2.5s
   - CLS < 0.1
   - INP < 200ms (if measurable)
4. All routes show skeleton loading states
5. File components load lazily
6. Mobile swipe gestures work
7. Build succeeds

</verification>

<success_criteria>

- WebVitalsReporter captures metrics on every page
- LCP < 2.5 seconds (2-second target with margin)
- CLS < 0.1 (no visible layout shifts)
- INP < 200ms for user interactions
- Mobile experience includes swipe gestures and hamburger menu
- Production build succeeds without errors

</success_criteria>

<output>
After completion, create
`.planning/phases/07-performance-quality/07-04-SUMMARY.md`
</output>
