---
phase: 05-file-attachments
plan: 07
type: execute
wave: 5
depends_on: ["05-06"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can drag & drop files onto task edit page"
    - "Upload progress shows percentage and allows cancel"
    - "Uploaded files appear in file list immediately"
    - "Thumbnails display for image files"
    - "Files can be downloaded by clicking"
    - "Files can be deleted with confirmation"
    - "Task cards show file count indicators"
    - "Large files (> 5MB) upload successfully with resume"
    - "Invalid files show clear error messages"
  artifacts: []
  key_links: []
---

<objective>
Human verification of the complete file attachment system.

Purpose: Validate that all file attachment features work correctly through real user testing. This covers the full user journey from upload to download to delete.

Output: Verified file attachment system ready for production
</objective>

<execution_context>
@/Users/dansidanutz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dansidanutz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-file-attachments/05-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify complete file attachment flow</name>
  <what-built>
Complete file attachment system including:
- Drag & drop file upload with react-dropzone
- Progress tracking with percentage and cancel
- TUS protocol for large files (> 5MB) with resume capability
- Server Actions for small files (< 5MB)
- Thumbnail generation for images with Sharp
- File type validation by content (not extension)
- Secure download endpoint with ownership verification
- File list display with thumbnails and icons
- Delete with confirmation
- Task card file count indicators
  </what-built>
  <how-to-verify>
**Setup:**
1. Start the dev server: `npm run dev`
2. Navigate to http://localhost:3000
3. Login with GitHub
4. Create a new task or edit an existing one

**Test 1: Small file upload (< 5MB)**
1. Go to task edit page
2. Drag a small image (JPEG, PNG) onto the upload area
3. Verify: Progress bar shows and completes quickly
4. Verify: File appears in the file list with thumbnail
5. Verify: File name and size are displayed

**Test 2: Large file upload (> 5MB)**
1. Find or create a file larger than 5MB (can be any type)
2. Drag onto upload area
3. Verify: Progress bar shows incremental progress
4. Verify: Can click Cancel to stop upload (test mid-upload)
5. Verify: Successful upload shows in file list

**Test 3: Multiple file upload**
1. Select multiple files and drag at once
2. Verify: All files show in progress list
3. Verify: Progress updates independently for each
4. Verify: All files appear when complete

**Test 4: File validation**
1. Try uploading a very large file (> 25MB)
2. Verify: Error message about file size limit
3. Try renaming a file to fake extension (e.g., malware.txt.jpg)
4. Verify: System rejects based on actual content

**Test 5: Thumbnails and previews**
1. Upload an image file
2. Verify: Thumbnail appears (not just icon)
3. Click the thumbnail
4. Verify: Preview modal opens with full image
5. Verify: Download button works

**Test 6: Non-image files**
1. Upload a PDF or document
2. Verify: File type icon appears (not thumbnail)
3. Click to preview
4. Verify: PDF shows in iframe, or download prompt for other types

**Test 7: File deletion**
1. Click delete on an uploaded file
2. Verify: Confirmation dialog appears
3. Confirm deletion
4. Verify: File disappears from list immediately
5. Verify: File no longer downloadable

**Test 8: Task card indicators**
1. Go to task list page
2. Find a task with attachments
3. Verify: File count badge visible on card
4. Verify: Count matches actual number of files

**Test 9: Network interruption (optional)**
1. Start uploading a large file
2. Disconnect network briefly
3. Reconnect
4. Verify: Upload resumes (may need page refresh)

**Test 10: Security**
1. Try accessing /api/files/download/[random-id]
2. Verify: Returns 404 or 403 (not server error)
3. Logout and try accessing a file URL directly
4. Verify: Returns 401 Unauthorized
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All tests in the human verification checklist must pass.
</verification>

<success_criteria>
Phase 5 is complete when:
- [ ] Small file upload works (< 5MB via Server Action)
- [ ] Large file upload works (> 5MB via TUS)
- [ ] Progress bars display correctly with percentage
- [ ] Cancel button stops in-progress uploads
- [ ] File validation rejects invalid/oversized files
- [ ] Thumbnails generate for images
- [ ] File preview modal works for images and PDFs
- [ ] Download works for all file types
- [ ] Delete removes files with confirmation
- [ ] Task cards show file count indicators
- [ ] Security: Only file owners can access files
- [ ] Error messages are clear and helpful
</success_criteria>

<output>
After completion, create `.planning/phases/05-file-attachments/05-07-SUMMARY.md` documenting:
- All verified features
- Any issues found and fixed
- Performance observations
- Patterns established for reuse
</output>
