---
phase: 08-deployment-validation
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/shared/components/FeedbackWidget.tsx
  - src/shared/components/index.ts
  - src/app/layout.tsx
  - src/shared/actions/feedback.ts
autonomous: true

must_haves:
  truths:
    - "Users can submit feedback without leaving the page"
    - "Feedback form captures page context and user identity"
    - "Feedback is stored for later review"
  artifacts:
    - path: "src/shared/components/FeedbackWidget.tsx"
      provides: "Floating feedback button and form"
      min_lines: 50
    - path: "src/shared/actions/feedback.ts"
      provides: "Server action to store feedback"
      exports: ["submitFeedback"]
  key_links:
    - from: "src/shared/components/FeedbackWidget.tsx"
      to: "src/shared/actions/feedback.ts"
      via: "form submission"
      pattern: "submitFeedback"
    - from: "src/app/layout.tsx"
      to: "FeedbackWidget"
      via: "component import"
      pattern: "FeedbackWidget"
---

<objective>
Add in-app feedback collection widget for validation user input.

Purpose: Enable users to share their experience directly within the app, providing framework validation data without requiring external tools.

Output: Floating feedback button, feedback form component, server action to store feedback.
</objective>

<execution_context>
@/Users/dansidanutz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dansidanutz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-deployment-validation/08-RESEARCH.md
@.planning/phases/08-deployment-validation/08-01-PLAN.md

@src/app/layout.tsx
@src/shared/components/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create feedback Server Action with database storage</name>
  <files>src/shared/actions/feedback.ts</files>
  <action>
Create a Server Action to store user feedback:

1. Create src/shared/actions/feedback.ts with 'use server' directive
2. Import prisma and getCurrentUser from existing modules
3. Create submitFeedback action that:
   - Accepts feedback text and optional metadata (page path, type: bug/idea/other)
   - Gets current user from session (if authenticated)
   - Stores in analytics_events table using existing trackEvent pattern:
     - eventType: 'feedback_submitted'
     - userId: current user or null
     - metadata: { feedback, page, type, userAgent, timestamp }
   - Returns { success: true } or { error: string }

4. Use the existing analytics tracking infrastructure (Phase 6 already has this)

Note: Do NOT create a new database table - reuse analytics_events for simplicity.
Feedback is just another type of event to track.
  </action>
  <verify>
Check file exists: ls src/shared/actions/feedback.ts
Contains 'use server' directive
Contains submitFeedback export
Uses trackEvent or prisma.analyticsEvent
  </verify>
  <done>Feedback Server Action stores feedback in analytics_events table</done>
</task>

<task type="auto">
  <name>Task 2: Create FeedbackWidget component</name>
  <files>src/shared/components/FeedbackWidget.tsx, src/shared/components/index.ts</files>
  <action>
Create a floating feedback widget component:

1. Create src/shared/components/FeedbackWidget.tsx as a 'use client' component
2. Design a floating button in bottom-right corner:
   - Fixed position: fixed bottom-4 right-4 z-50
   - Circular button with chat icon (use @heroicons/react ChatBubbleOvalLeftIcon)
   - Blue background (bg-blue-600) with white icon
   - Shadow for visibility (shadow-lg)

3. On click, expand to feedback form:
   - Slide-up animation (or simple show/hide)
   - White card with border and shadow
   - Textarea for feedback (placeholder: "What's on your mind?")
   - Select dropdown for type: Bug Report, Feature Idea, Other
   - Cancel and Submit buttons
   - Character limit display (500 max)

4. On submit:
   - Call submitFeedback Server Action with:
     - feedback text
     - page path (window.location.pathname)
     - type (bug/idea/other)
   - Show loading state during submission
   - Show success message briefly, then close
   - Show error message if failed

5. Use Tailwind for all styling (consistent with existing components)

6. Export from src/shared/components/index.ts
  </action>
  <verify>
Check files exist:
- ls src/shared/components/FeedbackWidget.tsx
- grep "FeedbackWidget" src/shared/components/index.ts

Component uses 'use client' directive
Component imports submitFeedback from '../actions/feedback'
Component uses fixed positioning
  </verify>
  <done>FeedbackWidget component provides floating feedback form</done>
</task>

<task type="auto">
  <name>Task 3: Integrate FeedbackWidget into root layout</name>
  <files>src/app/layout.tsx</files>
  <action>
Add FeedbackWidget to the root layout so it appears on all pages:

1. Import FeedbackWidget from '@/shared/components'
2. Add FeedbackWidget inside the body, after the main content but before closing body tag
3. Position it so it doesn't interfere with the main layout

Note: FeedbackWidget handles its own positioning (fixed), so just include it as a sibling to main content.

The widget should be visible on all pages for easy access.
  </action>
  <verify>
Start dev server: npm run dev
Navigate to http://localhost:3000
Verify floating feedback button appears in bottom-right corner
Click button - form should expand
Submit feedback - should show success
  </verify>
  <done>FeedbackWidget integrated into root layout and accessible on all pages</done>
</task>

</tasks>

<verification>
- [ ] Feedback button visible on all pages (bottom-right corner)
- [ ] Clicking button opens feedback form
- [ ] Form allows selecting type (bug/idea/other)
- [ ] Submitting feedback shows success message
- [ ] Feedback stored in analytics_events table (check database)
</verification>

<success_criteria>
- Users can submit feedback from any page
- Feedback captures page context (pathname) and type
- Feedback is stored for later review in analytics_events
</success_criteria>

<output>
After completion, create `.planning/phases/08-deployment-validation/08-02-SUMMARY.md`
</output>
