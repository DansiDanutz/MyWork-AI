---
phase: 04-task-organization-discovery
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:

  - src/shared/components/TagInput.tsx
  - src/shared/components/TagBadge.tsx
  - src/shared/components/TaskCard.tsx
  - src/shared/components/TaskForm.tsx
  - src/shared/components/TaskEditForm.tsx
  - src/app/(app)/tasks/new/page.tsx
  - src/app/(app)/tasks/[id]/edit/page.tsx

autonomous: true

must_haves:
  truths:

```markdown

- "Tasks display their associated tags visually"
- "User can add tags when creating a task"
- "User can add/remove tags when editing a task"
- "Tag input allows typing new tags or selecting existing"
- "Tags are visually distinguished by color"

```yaml

  artifacts:

```yaml

- path: "src/shared/components/TagInput.tsx"

  provides: "Autocomplete tag input with create-on-enter"
  min_lines: 80

- path: "src/shared/components/TagBadge.tsx"

  provides: "Colored tag display component"
  min_lines: 20

- path: "src/shared/components/TaskCard.tsx"

  provides: "TaskCard with tag display"
  contains: "TagBadge"

```yaml

  key_links:

```yaml

- from: "src/shared/components/TagInput.tsx"

  to: "src/app/actions/tags.ts"
  via: "addTagToTask Server Action"
  pattern: "addTagToTask"

- from: "src/shared/components/TaskEditForm.tsx"

  to: "src/app/actions/tags.ts"
  via: "updateTaskTags Server Action"
  pattern: "updateTaskTags"

```html

---

<objective>
Build tag management UI components for task creation and editing

Purpose: Enable users to organize tasks with tags during creation and editing,
displaying tags visually on task cards with color-coded badges.

Output: TagInput component with autocomplete, TagBadge display component,
updated TaskCard/TaskForm/TaskEditForm with tag support.
</objective>

<execution_context>
@/Users/dansidanutz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dansidanutz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-task-organization-discovery/04-CONTEXT.md
@.planning/phases/04-task-organization-discovery/04-RESEARCH.md
@.planning/phases/04-task-organization-discovery/04-01-SUMMARY.md
@src/shared/components/TaskCard.tsx
@src/shared/components/TaskForm.tsx
@src/shared/components/TaskEditForm.tsx
@src/app/actions/tags.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TagBadge display component</name>
  <files>src/shared/components/TagBadge.tsx</files>
  <action>
Create a simple tag badge component for displaying tags:

```typescript

'use client'

import { XMarkIcon } from '@heroicons/react/24/outline'

type TagBadgeProps = {
  name: string
  color?: string
  onRemove?: () => void
  size?: 'sm' | 'md'
}

export function TagBadge({
  name,
  color = '#6b7280',
  onRemove,
  size = 'sm',
}: TagBadgeProps) {
  const sizeClasses = {

```yaml

sm: 'text-xs px-2 py-0.5',
md: 'text-sm px-2.5 py-1',

```
  }

  return (

```yaml

<span
  className={`

```text
inline-flex items-center gap-1
${sizeClasses[size]}
rounded-full
font-medium
transition-colors

```yaml

  `}
  style={{

```yaml
backgroundColor: `${color}20`, // 20% opacity background
color: color,
borderColor: `${color}40`, // 40% opacity border
borderWidth: '1px',

```

  }}
>
  <span

```yaml
className="w-2 h-2 rounded-full flex-shrink-0"
style={{ backgroundColor: color }}

```bash

  />
  {name}
  {onRemove && (

```javascript
<button
  type="button"
  onClick={(e) => {

```

e.preventDefault()
e.stopPropagation()
onRemove()

```text
  }}
  className="

```

ml-0.5 -mr-1
rounded-full p-0.5
hover:bg-black/10 dark:hover:bg-white/10
transition-colors

```html

  "
  aria-label={`Remove ${name} tag`}
>
  <XMarkIcon className="h-3 w-3" />
</button>

```

  )}
</span>

```html

  )
}

```html

  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>TagBadge component exists with color support, optional remove button,
  and size variants</done>
</task>

<task type="auto">
  <name>Task 2: Create TagInput autocomplete component</name>
  <files>src/shared/components/TagInput.tsx</files>
  <action>
Create tag input with autocomplete and create-on-enter:

```typescript

'use client'

import { useState, useRef, useEffect, useCallback } from 'react'
import { Tag } from '@prisma/client'
import { TagBadge } from './TagBadge'
import { PlusIcon } from '@heroicons/react/24/outline'

type TagInputProps = {
  selectedTags: Tag[]
  availableTags: Tag[]
  onAddTag: (tagName: string) => Promise<void>
  onRemoveTag: (tagId: string) => void
  disabled?: boolean
}

// Preset colors for new tags
const TAG_COLORS = [
  '#3b82f6', // blue
  '#10b981', // green
  '#f59e0b', // amber
  '#ef4444', // red
  '#8b5cf6', // purple
  '#ec4899', // pink
  '#06b6d4', // cyan
  '#f97316', // orange
]

function getRandomColor(): string {
  return TAG_COLORS[Math.floor(Math.random() * TAG_COLORS.length)]
}

export function TagInput({
  selectedTags,
  availableTags,
  onAddTag,
  onRemoveTag,
  disabled = false,
}: TagInputProps) {
  const [inputValue, setInputValue] = useState('')
  const [isOpen, setIsOpen] = useState(false)
  const [isAdding, setIsAdding] = useState(false)
  const inputRef = useRef<HTMLInputElement>(null)
  const dropdownRef = useRef<HTMLDivElement>(null)

  // Filter available tags based on input and exclude already selected
  const filteredTags = availableTags.filter(

```javascript

(tag) =>
  !selectedTags.some((t) => t.id === tag.id) &&
  tag.name.toLowerCase().includes(inputValue.toLowerCase())

```javascript
  )

  // Check if input matches an existing tag exactly
  const exactMatch = availableTags.find(

```javascript

(tag) => tag.name.toLowerCase() === inputValue.toLowerCase()

```bash
  )

  // Show "create new" option if input doesn't match existing tag
  const showCreateOption = inputValue.trim() && !exactMatch

  // Handle clicking outside to close dropdown
  useEffect(() => {

```javascript

function handleClickOutside(event: MouseEvent) {
  if (

```
dropdownRef.current &&
!dropdownRef.current.contains(event.target as Node) &&
!inputRef.current?.contains(event.target as Node)

```text

  ) {

```javascript
setIsOpen(false)

```javascript

  }
}

document.addEventListener('mousedown', handleClickOutside)
return () => document.removeEventListener('mousedown', handleClickOutside)

```
  }, [])

  const handleAddTag = useCallback(async (tagName: string) => {

```bash

if (!tagName.trim() || isAdding || disabled) return

setIsAdding(true)
try {
  await onAddTag(tagName.trim())
  setInputValue('')
  setIsOpen(false)
} finally {
  setIsAdding(false)
}

```javascript
  }, [onAddTag, isAdding, disabled])

  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {

```bash

if (e.key === 'Enter' && inputValue.trim()) {
  e.preventDefault()
  handleAddTag(inputValue)
} else if (e.key === 'Escape') {
  setIsOpen(false)
  inputRef.current?.blur()
}

```html

  }, [inputValue, handleAddTag])

  return (

```html

<div className="space-y-2">
  {/* Selected tags */}
  {selectedTags.length > 0 && (

```html

<div className="flex flex-wrap gap-1.5">
  {selectedTags.map((tag) => (

```

<TagBadge
  key={tag.id}
  name={tag.name}
  color={tag.color || undefined}
  onRemove={disabled ? undefined : () => onRemoveTag(tag.id)}
/>

```html

  ))}
</div>

```

  )}

  {/* Input with dropdown */}
  <div className="relative">

```javascript
<input
  ref={inputRef}
  type="text"
  value={inputValue}
  onChange={(e) => {

```text

setInputValue(e.target.value)
setIsOpen(true)

```
  }}
  onFocus={() => setIsOpen(true)}
  onKeyDown={handleKeyDown}
  placeholder={selectedTags.length > 0 ? 'Add another tag...' : 'Add
  tags...'}
  disabled={disabled || isAdding}
  className="

```yaml

block w-full
px-3 py-2
border border-gray-300 dark:border-gray-600
rounded-md
bg-white dark:bg-gray-800
text-gray-900 dark:text-gray-100
placeholder-gray-500 dark:placeholder-gray-400
focus:ring-2 focus:ring-blue-500 focus:border-transparent
text-sm
disabled:opacity-50 disabled:cursor-not-allowed

```
  "
/>

{/* Dropdown */}
{isOpen && (filteredTags.length > 0 || showCreateOption) && (
  <div

```yaml

ref={dropdownRef}
className="
  absolute z-10 mt-1 w-full
  bg-white dark:bg-gray-800
  border border-gray-200 dark:border-gray-700
  rounded-md shadow-lg
  max-h-48 overflow-y-auto
"

```
  >

```bash

{/* Create new tag option */}
{showCreateOption && (
  <button

```
type="button"
onClick={() => handleAddTag(inputValue)}
disabled={isAdding}
className="
  w-full px-3 py-2
  text-left text-sm
  flex items-center gap-2
  text-blue-600 dark:text-blue-400
  hover:bg-gray-100 dark:hover:bg-gray-700
  disabled:opacity-50
"

```
  >

```
<PlusIcon className="h-4 w-4" />
Create &quot;{inputValue.trim()}&quot;

```
  </button>
)}

{/* Existing tags */}
{filteredTags.map((tag) => (
  <button

```
key={tag.id}
type="button"
onClick={() => handleAddTag(tag.name)}
disabled={isAdding}
className="
  w-full px-3 py-2
  text-left text-sm
  flex items-center gap-2
  text-gray-700 dark:text-gray-300
  hover:bg-gray-100 dark:hover:bg-gray-700
  disabled:opacity-50
"

```
  >

```
<span
  className="w-3 h-3 rounded-full flex-shrink-0"
  style={{ backgroundColor: tag.color || '#6b7280' }}
/>
{tag.name}

```
  </button>
))}

```
  </div>
)}

```html

  </div>

  {isAdding && (

```yaml
<p className="text-xs text-gray-500 dark:text-gray-400">Adding tag...</p>

```

  )}
</div>

```html

  )
}

```html

  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>TagInput component with autocomplete dropdown, create-on-enter, and
  loading states</done>
</task>

<task type="auto">
  <name>Task 3: Update TaskCard to display tags</name>
  <files>src/shared/components/TaskCard.tsx</files>
  <action>
Update TaskCard to show tags on task cards. Modify the existing TaskCard
component:

1. Update the Task type to include tags:

```typescript

type Task = {
  id: string
  title: string
  description: string | null
  status: 'TODO' | 'IN_PROGRESS' | 'DONE'
  createdAt: Date
  updatedAt: Date
  tags?: { id: string; name: string; color: string | null }[]
}

```yaml

2. Import TagBadge at the top:

```typescript

import { TagBadge } from './TagBadge'

```yaml

3. Add tags display after the task title (before description):

```typescript

{/* Tags */}
{optimisticTask.tags && optimisticTask.tags.length > 0 && (
  <div className="flex flex-wrap gap-1 mb-2">

```javascript

{optimisticTask.tags.slice(0, 3).map((tag) => (
  <TagBadge

```bash
key={tag.id}
name={tag.name}
color={tag.color || undefined}
size="sm"

```

  />
))}
{optimisticTask.tags.length > 3 && (
  <span className="text-xs text-gray-500 dark:text-gray-400">

```text
+{optimisticTask.tags.length - 3} more

```html

  </span>
)}

```html

  </div>
)}

```html

Place this JSX after the title `<h3>` element and before the description `<p>`
element.

Also update the useOptimistic to handle tags in the task object.
  </action>
  <verify>TypeScript compiles and component renders: `npm run dev`</verify>
  <done>TaskCard displays tags with color-coded badges, showing max 3 with "+N
  more" overflow</done>
</task>

<task type="auto">
  <name>Task 4: Update TaskForm to include tag input</name>
  <files>src/shared/components/TaskForm.tsx,
  src/app/(app)/tasks/new/page.tsx</files>
  <action>
Update TaskForm to accept tags during task creation:

1. First, update the tasks/new/page.tsx to fetch available tags:

```typescript

import { getTagsByUser, verifySession } from '@/shared/lib/dal'
import { TaskFormWithTags } from '@/shared/components/TaskFormWithTags'

export default async function NewTaskPage() {
  const { userId } = await verifySession()
  const tags = await getTagsByUser(userId)

  return (

```html

<div className="max-w-2xl mx-auto">
  <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-8">

```
Create New Task

```html

  </h1>
  <TaskFormWithTags availableTags={tags} />
</div>

```yaml
  )
}

```yaml

2. Create a new component `src/shared/components/TaskFormWithTags.tsx`:

```typescript

'use client'

import { useActionState, useState, useCallback } from 'react'
import { useRouter } from 'next/navigation'
import { createTask } from '@/app/actions/tasks'
import { addTagToTask } from '@/app/actions/tags'
import { TagInput } from './TagInput'
import { Tag } from '@prisma/client'

type TaskFormWithTagsProps = {
  availableTags: Tag[]
}

type FormState = {
  success?: boolean
  error?: string
  data?: { taskId: string }
}

async function createTaskAction(
  prevState: FormState,
  formData: FormData
): Promise<FormState> {
  const result = await createTask(formData)
  return result
}

export function TaskFormWithTags({ availableTags }: TaskFormWithTagsProps) {
  const router = useRouter()
  const [state, formAction, isPending] = useActionState(createTaskAction, {})
  const [selectedTags, setSelectedTags] = useState<Tag[]>([])
  const [localTags, setLocalTags] = useState<Tag[]>(availableTags)

  // After task is created, add tags to it
  const handleSubmit = async (formData: FormData) => {

```javascript

const result = await createTask(formData)

if (result.success && result.data?.taskId && selectedTags.length > 0) {
  // Add each tag to the task
  for (const tag of selectedTags) {

```
await addTagToTask(result.data.taskId, tag.name)

```javascript

  }
}

if (result.success) {
  router.push('/tasks')
}

return result

```javascript
  }

  const handleAddTag = useCallback(async (tagName: string) => {

```javascript

// Check if tag already exists in local list
const existingTag = localTags.find(
  t => t.name.toLowerCase() === tagName.toLowerCase()
)

if (existingTag) {
  setSelectedTags(prev => [...prev, existingTag])
} else {
  // Create a temporary tag for display (will be created on submit)
  const tempTag: Tag = {

```yaml
id: `temp-${Date.now()}`,
name: tagName,
color: '#6b7280',
userId: '',
createdAt: new Date(),

```

  }
  setSelectedTags(prev => [...prev, tempTag])
  setLocalTags(prev => [...prev, tempTag])
}

```javascript
  }, [localTags])

  const handleRemoveTag = useCallback((tagId: string) => {

```javascript

setSelectedTags(prev => prev.filter(t => t.id !== tagId))

```text
  }, [])

  return (

```html

<form action={handleSubmit} className="space-y-6">
  {/* Title field */}
  <div>

```yaml
<label
  htmlFor="title"
  className="block text-sm font-medium text-gray-700 dark:text-gray-300
  mb-1"
>
  Title <span className="text-red-500">*</span>
</label>
<input
  type="text"
  id="title"
  name="title"
  required
  maxLength={255}
  className="

```

block w-full
px-3 py-2
border border-gray-300 dark:border-gray-600
rounded-md
bg-white dark:bg-gray-800
text-gray-900 dark:text-gray-100
focus:ring-2 focus:ring-blue-500 focus:border-transparent

```text
  "
  placeholder="What needs to be done?"
/>

```

  </div>

  {/* Description field */}
  <div>

```yaml
<label
  htmlFor="description"
  className="block text-sm font-medium text-gray-700 dark:text-gray-300
  mb-1"
>
  Description
</label>
<textarea
  id="description"
  name="description"
  rows={4}
  className="

```yaml

block w-full
px-3 py-2
border border-gray-300 dark:border-gray-600
rounded-md
bg-white dark:bg-gray-800
text-gray-900 dark:text-gray-100
focus:ring-2 focus:ring-blue-500 focus:border-transparent

```
  "
  placeholder="Add some details..."
/>

```html

  </div>

  {/* Tags field */}
  <div>

```yaml
<label className="block text-sm font-medium text-gray-700 dark:text-gray-300
mb-1">
  Tags
</label>
<TagInput
  selectedTags={selectedTags}
  availableTags={localTags}
  onAddTag={handleAddTag}
  onRemoveTag={handleRemoveTag}
  disabled={isPending}
/>

```

  </div>

  {/* Error message */}
  {state.error && (

```yaml
<p className="text-sm text-red-600 dark:text-red-400">{state.error}</p>

```html

  )}

  {/* Submit button */}
  <div className="flex justify-end gap-3">

```javascript
<button
  type="button"
  onClick={() => router.back()}
  className="

```

px-4 py-2
border border-gray-300 dark:border-gray-600
rounded-md
text-gray-700 dark:text-gray-300
hover:bg-gray-50 dark:hover:bg-gray-700

```html

  "
>
  Cancel
</button>
<button
  type="submit"
  disabled={isPending}
  className="

```

px-4 py-2
bg-blue-600 text-white
rounded-md font-medium
hover:bg-blue-700
disabled:opacity-50 disabled:cursor-not-allowed

```json
  "
>
  {isPending ? 'Creating...' : 'Create Task'}
</button>

```

  </div>
</form>

```python
  )
}

```python

3. Export the new component from the components index:

```typescript

// In src/shared/components/index.ts
export { TaskFormWithTags } from './TaskFormWithTags'

```html

  </action>
  <verify>Run `npm run dev` and visit /tasks/new - form renders with tag
  input</verify>
  <done>Task creation form includes tag input, tags are added after task
  creation</done>
</task>

<task type="auto">
  <name>Task 5: Update TaskEditForm to include tag management</name>
  <files>src/shared/components/TaskEditForm.tsx,
  src/app/(app)/tasks/[id]/edit/page.tsx</files>
  <action>
Update TaskEditForm to allow tag management on existing tasks:

1. Update the edit page to fetch task with tags and available tags:

```typescript

// src/app/(app)/tasks/[id]/edit/page.tsx
import { notFound } from 'next/navigation'
import { verifySession, getTaskWithTags, getTagsByUser } from '@/shared/lib/dal'
import { TaskEditFormWithTags } from '@/shared/components/TaskEditFormWithTags'

type PageProps = {
  params: Promise<{ id: string }>
}

export default async function EditTaskPage({ params }: PageProps) {
  const { id } = await params
  const { userId } = await verifySession()

  const [task, tags] = await Promise.all([

```text

getTaskWithTags(id, userId),
getTagsByUser(userId),

```html

  ])

  if (!task) {

```text

notFound()

```html

  }

  return (

```html

<div className="max-w-2xl mx-auto">
  <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-8">

```
Edit Task

```html

  </h1>
  <TaskEditFormWithTags task={task} availableTags={tags} />
</div>

```yaml
  )
}

```yaml

2. Create a new component `src/shared/components/TaskEditFormWithTags.tsx`:

```typescript

'use client'

import { useActionState, useState, useCallback, useTransition } from 'react'
import { useRouter } from 'next/navigation'
import { updateTask, deleteTask } from '@/app/actions/tasks'
import { updateTaskTags, addTagToTask } from '@/app/actions/tags'
import { TagInput } from './TagInput'
import { Tag, Task } from '@prisma/client'

type TaskWithTags = Task & { tags: Tag[] }

type TaskEditFormWithTagsProps = {
  task: TaskWithTags
  availableTags: Tag[]
}

type FormState = {
  success?: boolean
  error?: string
}

export function TaskEditFormWithTags({ task, availableTags }: TaskEditFormWithTagsProps) {
  const router = useRouter()
  const [isPending, startTransition] = useTransition()
  const [selectedTags, setSelectedTags] = useState<Tag[]>(task.tags)
  const [localTags, setLocalTags] = useState<Tag[]>(availableTags)
  const [formError, setFormError] = useState<string>()

  const updateTaskWithId = async (formData: FormData): Promise<FormState> => {

```javascript

const result = await updateTask(task.id, formData)
return result

```javascript
  }

  const [state, formAction] = useActionState(updateTaskWithId, {})

  const handleAddTag = useCallback(async (tagName: string) => {

```javascript

// Check if tag already exists
const existingTag = localTags.find(
  t => t.name.toLowerCase() === tagName.toLowerCase()
)

if (existingTag && !selectedTags.some(t => t.id === existingTag.id)) {
  // Add existing tag
  const newTags = [...selectedTags, existingTag]
  setSelectedTags(newTags)

  // Update on server
  const result = await addTagToTask(task.id, existingTag.name)
  if (!result.success) {

```
// Rollback on error
setSelectedTags(selectedTags)
setFormError(result.error)

```javascript

  }
} else if (!existingTag) {
  // Create new tag via server action
  const result = await addTagToTask(task.id, tagName)
  if (result.success && result.data) {

```javascript
const newTag: Tag = {
  id: result.data.tagId,
  name: tagName,
  color: '#6b7280',
  userId: task.userId,
  createdAt: new Date(),
}
setSelectedTags(prev => [...prev, newTag])
setLocalTags(prev => [...prev, newTag])

```text

  } else if (!result.success) {

```
setFormError(result.error)

```text

  }
}

```javascript
  }, [localTags, selectedTags, task.id, task.userId])

  const handleRemoveTag = useCallback(async (tagId: string) => {

```javascript

const newTags = selectedTags.filter(t => t.id !== tagId)
setSelectedTags(newTags)

// Update on server
const result = await updateTaskTags(task.id, newTags.map(t => t.id))
if (!result.success) {
  // Rollback on error
  setSelectedTags(selectedTags)
  setFormError(result.error)
}

```javascript
  }, [selectedTags, task.id])

  const handleDelete = async () => {

```javascript

if (!confirm('Are you sure you want to delete this task?')) {
  return
}

startTransition(async () => {
  const result = await deleteTask(task.id)
  if (result.success) {

```
router.push('/tasks')

```text

  } else {

```text
setFormError(result.error)

```text

  }
})

```
  }

  return (

```html

<form action={formAction} className="space-y-6">
  {/* Title field */}
  <div>

```yaml
<label
  htmlFor="title"
  className="block text-sm font-medium text-gray-700 dark:text-gray-300
  mb-1"
>
  Title <span className="text-red-500">*</span>
</label>
<input
  type="text"
  id="title"
  name="title"
  required
  maxLength={255}
  defaultValue={task.title}
  className="

```yaml

block w-full
px-3 py-2
border border-gray-300 dark:border-gray-600
rounded-md
bg-white dark:bg-gray-800
text-gray-900 dark:text-gray-100
focus:ring-2 focus:ring-blue-500 focus:border-transparent

```
  "
/>

```html

  </div>

  {/* Description field */}
  <div>

```yaml
<label
  htmlFor="description"
  className="block text-sm font-medium text-gray-700 dark:text-gray-300
  mb-1"
>
  Description
</label>
<textarea
  id="description"
  name="description"
  rows={4}
  defaultValue={task.description || ''}
  className="

```

block w-full
px-3 py-2
border border-gray-300 dark:border-gray-600
rounded-md
bg-white dark:bg-gray-800
text-gray-900 dark:text-gray-100
focus:ring-2 focus:ring-blue-500 focus:border-transparent

```text
  "
/>

```

  </div>

  {/* Status field */}
  <div>

```yaml
<label
  htmlFor="status"
  className="block text-sm font-medium text-gray-700 dark:text-gray-300
  mb-1"
>
  Status
</label>
<select
  id="status"
  name="status"
  defaultValue={task.status}
  className="

```yaml

block w-full
px-3 py-2
border border-gray-300 dark:border-gray-600
rounded-md
bg-white dark:bg-gray-800
text-gray-900 dark:text-gray-100
focus:ring-2 focus:ring-blue-500 focus:border-transparent

```
  "
>
  <option value="TODO">To Do</option>
  <option value="IN_PROGRESS">In Progress</option>
  <option value="DONE">Done</option>
</select>

```html

  </div>

  {/* Tags field */}
  <div>

```yaml
<label className="block text-sm font-medium text-gray-700 dark:text-gray-300
mb-1">
  Tags
</label>
<TagInput
  selectedTags={selectedTags}
  availableTags={localTags}
  onAddTag={handleAddTag}
  onRemoveTag={handleRemoveTag}
  disabled={isPending}
/>

```

  </div>

  {/* Error message */}
  {(state.error || formError) && (

```yaml
<p className="text-sm text-red-600 dark:text-red-400">
  {state.error || formError}
</p>

```html

  )}

  {/* Action buttons */}
  <div className="flex justify-between">

```yaml
<button
  type="button"
  onClick={handleDelete}
  disabled={isPending}
  className="

```

px-4 py-2
bg-red-600 text-white
rounded-md font-medium
hover:bg-red-700
disabled:opacity-50 disabled:cursor-not-allowed

```json
  "
>
  {isPending ? 'Deleting...' : 'Delete Task'}
</button>

<div className="flex gap-3">
  <button

```

type="button"
onClick={() => router.back()}
className="
  px-4 py-2
  border border-gray-300 dark:border-gray-600
  rounded-md
  text-gray-700 dark:text-gray-300
  hover:bg-gray-50 dark:hover:bg-gray-700
"

```text
  >

```

Cancel

```html

  </button>
  <button

```

type="submit"
disabled={isPending}
className="
  px-4 py-2
  bg-blue-600 text-white
  rounded-md font-medium
  hover:bg-blue-700
  disabled:opacity-50 disabled:cursor-not-allowed
"

```text
  >

```

{isPending ? 'Saving...' : 'Save Changes'}

```html

  </button>
</div>

```

  </div>
</form>

```python
  )
}

```python

3. Export the new component from the components index.

  </action>
  <verify>Run `npm run dev` and visit /tasks/[id]/edit - form renders with
  current tags</verify>
  <done>Task edit form allows adding/removing tags with immediate server
  sync</done>
</task>

</tasks>

<verification>

1. Run `npx tsc --noEmit` - TypeScript compiles without errors
2. Run `npm run dev` - development server starts
3. Visit /tasks - task cards show tags if they have any
4. Visit /tasks/new - can add tags while creating task
5. Create a task with tags - tags are saved correctly
6. Visit /tasks/[id]/edit - existing tags are shown and can be modified

</verification>

<success_criteria>

- TagBadge component displays colored tag pills
- TagInput component has autocomplete and create-on-enter
- TaskCard shows tags with color badges (max 3 visible)
- Task creation form includes tag input
- Task edit form allows adding/removing tags
- Tag changes sync to server immediately

</success_criteria>

<output>
After completion, create
`.planning/phases/04-task-organization-discovery/04-03-SUMMARY.md`
</output>
